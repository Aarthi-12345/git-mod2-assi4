This is the new master code in public2 branch
